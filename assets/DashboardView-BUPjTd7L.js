import{u as I,f as L,r as y,g as R,h as W,c as f,w as e,i as D,a as n,j as q,o as i,b as o,k as x,l as C,m as a,t as p,n as u,d as g}from"./index-B8VNrrUr.js";const F={class:"text-h4 font-weight-bold"},G={key:1},J={class:"text-h3"},K={class:"text-h3"},O={key:2},P={class:"text-h5 font-weight-bold"},X={__name:"DashboardView",setup(Q){const v=q(),N=I(),S=L(),{user:r,userName:T}=N,c=y(!0),k=y({}),w=y(null),$=R(()=>`歡迎回來，${T}！`);async function V(){c.value=!0;try{if(r.role==="admin"){const{data:s}=await D.get("/bookings"),t=new Date;t.setHours(0,0,0,0);const l=s.filter(d=>new Date(d.dateTime)>=t);k.value={totalBookings:s.length,upcomingBookings:l.length}}else if(r.role==="client"){const{data:s}=await D.get(`/bookings?userId=${r.id}&_sort=dateTime&_order=asc`),t=new Date;w.value=s.find(l=>new Date(l.dateTime)>t)}}catch{S.showSnackbar("無法載入儀表板資訊","error")}finally{c.value=!1}}function j(s){return s?new Date(s).toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}return W(V),(s,t)=>{const l=n("v-col"),d=n("v-row"),z=n("v-skeleton-loader"),h=n("v-icon"),m=n("v-card-text"),_=n("v-card"),B=n("v-list-item"),A=n("v-card-title"),M=n("v-btn"),E=n("v-card-actions"),H=n("v-container");return i(),f(H,null,{default:e(()=>[o(d,null,{default:e(()=>[o(l,{cols:"12"},{default:e(()=>[a("h1",F,p($.value),1),t[4]||(t[4]=a("p",{class:"text-grey-darken-1"},"這是您的預約系統總覽。",-1))]),_:1,__:[4]})]),_:1}),c.value?(i(),f(z,{key:0,type:"card@2"})):x("",!0),!c.value&&u(r).role==="admin"?(i(),C("div",G,[o(d,null,{default:e(()=>[o(l,{md:"6",cols:"12"},{default:e(()=>[o(_,{color:"primary",dark:"",rounded:"lg",onClick:t[0]||(t[0]=b=>u(v).push("/all-bookings")),hover:""},{default:e(()=>[o(m,{class:"d-flex justify-space-between align-center"},{default:e(()=>[a("div",null,[a("div",J,p(k.value.totalBookings),1),t[5]||(t[5]=a("div",{class:"text-subtitle-1"},"總預約數 (點擊查看)",-1))]),o(h,{size:"64"},{default:e(()=>t[6]||(t[6]=[g("mdi-calendar-multiple",-1)])),_:1,__:[6]})]),_:1})]),_:1})]),_:1}),o(l,{md:"6",cols:"12"},{default:e(()=>[o(_,{rounded:"lg"},{default:e(()=>[o(m,{class:"d-flex justify-space-between align-center"},{default:e(()=>[a("div",null,[a("div",K,p(k.value.upcomingBookings),1),t[7]||(t[7]=a("div",{class:"text-subtitle-1"},"待處理預約",-1))]),o(h,{size:"64",color:"warning"},{default:e(()=>t[8]||(t[8]=[g("mdi-calendar-clock",-1)])),_:1,__:[8]})]),_:1})]),_:1})]),_:1})]),_:1}),o(d,null,{default:e(()=>[o(l,null,{default:e(()=>[o(_,{rounded:"lg",onClick:t[1]||(t[1]=b=>u(v).push("/admin")),hover:""},{default:e(()=>[o(B,{"prepend-icon":"mdi-cog",title:"前往設定",subtitle:"管理您的每週可預約時段"})]),_:1})]),_:1})]),_:1})])):x("",!0),!c.value&&u(r).role==="client"?(i(),C("div",O,[o(d,null,{default:e(()=>[o(l,{cols:"12"},{default:e(()=>[o(_,{color:"teal",dark:"",rounded:"lg"},{default:e(()=>[o(A,null,{default:e(()=>t[9]||(t[9]=[g("您的下一個預約",-1)])),_:1,__:[9]}),w.value?(i(),f(m,{key:0},{default:e(()=>[a("div",P,p(j(w.value.dateTime)),1)]),_:1})):(i(),f(m,{key:1},{default:e(()=>t[10]||(t[10]=[a("div",{class:"text-h6"},"您目前沒有即將到來的預約。",-1)])),_:1,__:[10]})),o(E,null,{default:e(()=>[o(M,{variant:"outlined",onClick:t[2]||(t[2]=b=>u(v).push("/my-bookings"))},{default:e(()=>t[11]||(t[11]=[g("查看所有預約",-1)])),_:1,__:[11]})]),_:1})]),_:1})]),_:1})]),_:1}),o(d,null,{default:e(()=>[o(l,null,{default:e(()=>[o(_,{rounded:"lg",onClick:t[3]||(t[3]=b=>u(v).push("/book-appointment")),hover:""},{default:e(()=>[o(B,{"prepend-icon":"mdi-calendar-plus",title:"預約新時段",subtitle:"查看可預約的時間並安排您的下一次服務"})]),_:1})]),_:1})]),_:1})])):x("",!0)]),_:1})}}};export{X as default};
